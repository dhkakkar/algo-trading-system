{
  "annotations": { "list": [] },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "id": 1,
      "title": "Total Users",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT COUNT(*) AS \"Users\" FROM users;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 2,
      "title": "Total Strategies",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT COUNT(*) AS \"Strategies\" FROM strategies;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "purple", "value": null }] }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 3,
      "title": "Instruments in DB",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT COUNT(*) AS \"Instruments\" FROM instruments;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "orange", "value": null }] }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 4,
      "title": "OHLCV Data Points",
      "type": "stat",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 0 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT COUNT(*) AS \"Data Points\" FROM ohlcv_data;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "green", "value": null }] }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 5,
      "title": "Database Table Sizes",
      "type": "table",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 4 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT relname AS \"Table\", pg_size_pretty(pg_total_relation_size(relid)) AS \"Total Size\", pg_size_pretty(pg_relation_size(relid)) AS \"Data Size\", pg_size_pretty(pg_total_relation_size(relid) - pg_relation_size(relid)) AS \"Index Size\", n_live_tup AS \"Row Count\" FROM pg_stat_user_tables WHERE schemaname = 'public' ORDER BY pg_total_relation_size(relid) DESC;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "options": { "showHeader": true }
    },
    {
      "id": 6,
      "title": "Market Data Coverage (Top Instruments)",
      "type": "table",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 4 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT tradingsymbol AS \"Symbol\", exchange AS \"Exchange\", interval AS \"Interval\", COUNT(*) AS \"Candles\", MIN(time) AS \"From\", MAX(time) AS \"To\" FROM ohlcv_data GROUP BY tradingsymbol, exchange, interval ORDER BY COUNT(*) DESC LIMIT 30;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "options": { "showHeader": true }
    },
    {
      "id": 7,
      "title": "Strategies by User",
      "type": "table",
      "gridPos": { "h": 8, "w": 12, "x": 0, "y": 12 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT u.email AS \"User\", COUNT(DISTINCT s.id) AS \"Strategies\", COUNT(DISTINCT b.id) AS \"Backtests\", COUNT(DISTINCT ts.id) AS \"Sessions\", COUNT(DISTINCT t.id) AS \"Trades\" FROM users u LEFT JOIN strategies s ON s.user_id = u.id LEFT JOIN backtests b ON b.user_id = u.id LEFT JOIN trading_sessions ts ON ts.user_id = u.id LEFT JOIN trades t ON t.user_id = u.id AND t.mode IN ('paper', 'live') GROUP BY u.email ORDER BY \"Strategies\" DESC;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "options": { "showHeader": true }
    },
    {
      "id": 8,
      "title": "Orders by Status",
      "type": "piechart",
      "gridPos": { "h": 8, "w": 12, "x": 12, "y": 12 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT status, COUNT(*) AS count FROM orders WHERE mode IN ('paper', 'live') GROUP BY status ORDER BY count DESC;",
          "format": "table",
          "refId": "A"
        }
      ],
      "options": {
        "legend": { "displayMode": "table", "placement": "right" },
        "pieType": "donut",
        "reduceOptions": { "calcs": ["lastNotNull"] }
      }
    },
    {
      "id": 9,
      "title": "New Data Ingestion (Daily)",
      "type": "timeseries",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 20 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT DATE(time) AS time, COUNT(*) AS \"Candles Stored\" FROM ohlcv_data WHERE time >= NOW() - INTERVAL '90 days' GROUP BY DATE(time) ORDER BY time;",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "green", "mode": "fixed" },
          "custom": { "drawStyle": "bars", "fillOpacity": 60 }
        },
        "overrides": []
      },
      "options": { "legend": { "displayMode": "list" } }
    },
    {
      "id": 10,
      "title": "PostgreSQL Active Connections",
      "type": "stat",
      "gridPos": { "h": 4, "w": 8, "x": 0, "y": 28 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT COUNT(*) AS \"Active Connections\" FROM pg_stat_activity WHERE state = 'active';",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "color": "green", "value": null },
              { "color": "yellow", "value": 10 },
              { "color": "red", "value": 50 }
            ]
          }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 11,
      "title": "Database Size",
      "type": "stat",
      "gridPos": { "h": 4, "w": 8, "x": 8, "y": 28 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT pg_size_pretty(pg_database_size('algo_trading')) AS \"DB Size\";",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "mode": "thresholds" },
          "thresholds": { "mode": "absolute", "steps": [{ "color": "blue", "value": null }] }
        },
        "overrides": []
      },
      "options": { "colorMode": "background", "reduceOptions": { "calcs": ["lastNotNull"] } }
    },
    {
      "id": 12,
      "title": "Slow Queries (> 1s)",
      "type": "table",
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 32 },
      "datasource": { "type": "postgres", "uid": "" },
      "targets": [
        {
          "rawSql": "SELECT query, calls, ROUND((total_exec_time / 1000)::numeric, 2) AS \"Total Time (s)\", ROUND((mean_exec_time / 1000)::numeric, 3) AS \"Avg Time (s)\", rows FROM pg_stat_statements WHERE mean_exec_time > 1000 ORDER BY mean_exec_time DESC LIMIT 20;",
          "format": "table",
          "refId": "A"
        }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] },
      "options": { "showHeader": true }
    }
  ],
  "refresh": "1m",
  "schemaVersion": 39,
  "tags": ["system"],
  "templating": { "list": [] },
  "time": { "from": "now-7d", "to": "now" },
  "timepicker": {},
  "timezone": "Asia/Kolkata",
  "title": "System Health",
  "uid": "system-health",
  "version": 1
}
